#!/usr/bin/python
#
# (c) Copyright 2008 Cloudera, Inc.
#
# Test tool for Cloudera Hadoop Distribution
#

# The python sources that make up the test framework
tester = PythonTarget(
  sources=[ "src/distrotester",
            "src/remotetest",
            "src/testdistrib"],
  requiredTargets=[ "python/Common",
                    "projects/HadoopDist/installer",
                    "projects/HadoopDist:versionStamps" ],
  dataPaths = [ "profiles",
                "hadoop-configs",
                "pig-tests",
                "hive-tests" ])


# package containing all the above python sources
pyRelease = PythonRedistTarget(
  packageName     = "distroTestPython",
  requiredTargets = [ ":tester" ])

# Jar containing Java code to run to for MapReduce tests
testsJar = JarTarget(
  jarName = "DistribTest.jar",
  sources = [ "mapreduce-tests" ],
  requiredTargets = [ "thirdparty/hadoop-0.19.0" ])


# Now we bundle all of the above together

pythonComponent = PackageComponent(
  targetName = ":pyRelease",
  includeZip = False) # copy files straight in

mapreduceTestsComponent = OutputComponent(
  targetName = ":testsJar",
  destDir = "testjar")

# Don't want the top-level install script included in our bin dir.
removeInstallerComponent = ExcludeComponent(
  name = "install")

release = PackageTarget(
  packageName = "distrotest",
  components = [
      pythonComponent,
      mapreduceTestsComponent,
      removeInstallerComponent ])

defaultTarget(release)

